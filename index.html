<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–û–¥–∏–Ω –î–æ–º–∞</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons (Lucide) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        .slide-panel { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden selection:bg-indigo-100">

    <!-- –•–µ–¥–µ—Ä -->
    <header class="bg-white/90 backdrop-blur-md border-b border-slate-200 z-20 flex-none px-4 py-3 flex justify-between items-center pt-safe-top">
        <div class="flex items-center gap-2">
            <div class="bg-indigo-600 p-1.5 rounded-lg text-white shadow-sm shadow-indigo-200">
                <i data-lucide="home" class="w-5 h-5"></i>
            </div>
            <h1 class="text-lg font-bold tracking-tight text-slate-900">–û–¥–∏–Ω –î–æ–º–∞</h1>
        </div>
        <button onclick="toggleSettings()" class="p-3 -mr-2 rounded-full bg-slate-50 text-slate-600 hover:bg-slate-100 transition-colors active:scale-95">
            <i data-lucide="sliders-horizontal" class="w-5 h-5"></i>
        </button>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="flex-1 overflow-y-auto relative flex flex-col bg-slate-50">
        
        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º -->
        <div class="px-2 py-2 flex justify-between items-center bg-white sticky top-0 z-10 shadow-sm">
            <button id="prevMonth" class="p-3 rounded-xl hover:bg-slate-100 text-slate-600 transition-colors active:bg-slate-200">
                <i data-lucide="chevron-left" class="w-6 h-6"></i>
            </button>
            <h2 id="currentMonthYear" class="text-lg font-bold capitalize text-slate-800 select-none"></h2>
            <button id="nextMonth" class="p-3 rounded-xl hover:bg-slate-100 text-slate-600 transition-colors active:bg-slate-200">
                <i data-lucide="chevron-right" class="w-6 h-6"></i>
            </button>
        </div>

        <!-- –î–Ω–∏ –Ω–µ–¥–µ–ª–∏ (–£–≤–µ–ª–∏—á–µ–Ω —à—Ä–∏—Ñ—Ç –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç) -->
        <div class="grid grid-cols-7 gap-1 px-3 py-2 text-center text-xs font-bold text-slate-500 uppercase tracking-wide bg-white/50 border-b border-slate-100">
            <div>–ü–Ω</div>
            <div>–í—Ç</div>
            <div>–°—Ä</div>
            <div>–ß—Ç</div>
            <div>–ü—Ç</div>
            <div class="text-rose-500">–°–±</div>
            <div class="text-rose-500">–í—Å</div>
        </div>

        <!-- –°–µ—Ç–∫–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è -->
        <div id="calendarGrid" class="grid grid-cols-7 gap-1 px-2 py-2 flex-1 auto-rows-min pb-20">
            <!-- JS –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–Ω–∏ –∑–¥–µ—Å—å -->
        </div>
    </main>

    <!-- –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Å—Ç–∞—Ç—É—Å–∞ (–î–æ–±–∞–≤–ª–µ–Ω pb-8 –¥–ª—è iPhone Safe Area) -->
    <div class="bg-white/95 backdrop-blur-xl border-t border-slate-200 px-5 py-3 pb-8 flex flex-col gap-2 shadow-[0_-8px_30px_rgba(0,0,0,0.04)] z-30 rounded-t-2xl">
        <div class="flex justify-between items-center mb-1">
            <span class="text-xs font-bold text-slate-500 uppercase tracking-wide">–°–µ–≥–æ–¥–Ω—è</span>
            <span id="todayStatusText" class="text-sm font-bold text-slate-800">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
        </div>
        
        <!-- –õ–µ–≥–µ–Ω–¥–∞ (–£–≤–µ–ª–∏—á–µ–Ω —à—Ä–∏—Ñ—Ç) -->
        <div class="grid grid-cols-4 gap-2 text-xs text-slate-600 font-medium text-center leading-tight">
            <div class="flex flex-col items-center gap-1 p-1.5 rounded-lg bg-emerald-50 border border-emerald-100">
                <div class="w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]"></div>
                <span class="text-emerald-700">–û–¥–∏–Ω!</span>
            </div>
            <div class="flex flex-col items-center gap-1 p-1.5 rounded-lg bg-blue-50 border border-blue-100">
                <div class="w-2.5 h-2.5 rounded-full bg-blue-500"></div>
                <span class="text-blue-700">–ü–∞–ø–∞</span>
            </div>
            <div class="flex flex-col items-center gap-1 p-1.5 rounded-lg bg-pink-50 border border-pink-100">
                <div class="w-2.5 h-2.5 rounded-full bg-pink-500"></div>
                <span class="text-pink-700">–ú–∞–º–∞</span>
            </div>
            <div class="flex flex-col items-center gap-1 p-1.5 rounded-lg bg-slate-50 border border-slate-200">
                <div class="w-2.5 h-2.5 rounded-full bg-slate-400"></div>
                <span>–í—Å–µ</span>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–£–º–µ–Ω—å—à–µ–Ω–∞ –≤—ã—Å–æ—Ç–∞ –∏ –æ—Ç—Å—Ç—É–ø—ã) -->
    <div id="settingsModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 hidden opacity-0 transition-opacity duration-300" aria-hidden="true">
        <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-5 shadow-2xl max-h-[85vh] h-auto overflow-y-auto slide-panel transform translate-y-full pb-8" id="settingsPanel">
            
            <div class="w-12 h-1.5 bg-slate-200 rounded-full mx-auto mb-5"></div>

            <div class="flex justify-between items-center mb-6">
                <div>
                    <h2 class="text-xl font-bold text-slate-900">–ì—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã</h2>
                    <p class="text-xs text-slate-500 mt-1">–ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ</p>
                </div>
                <button onclick="toggleSettings()" class="p-2 bg-slate-100 rounded-full hover:bg-slate-200 transition-colors">
                    <i data-lucide="x" class="w-6 h-6 text-slate-600"></i>
                </button>
            </div>

            <div class="space-y-4">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ü–ê–ü–´ -->
                <div class="bg-gradient-to-br from-blue-50 to-white p-4 rounded-2xl border border-blue-100 shadow-sm">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white shadow-md shadow-blue-200">
                            <i data-lucide="briefcase" class="w-4 h-4"></i>
                        </div>
                        <h3 class="font-bold text-base text-slate-800">–ü–∞–ø–∞</h3>
                    </div>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞</label>
                            <input type="date" id="dadStartDate" class="w-full p-3 rounded-xl border-slate-200 bg-white text-slate-800 text-sm font-medium shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–†–∞–±–æ—á–∏—Ö</label>
                                <input type="number" id="dadWorkDays" placeholder="2" min="1" class="w-full p-3 rounded-xl border-slate-200 bg-white text-sm shadow-sm focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–í—ã—Ö–æ–¥–Ω—ã—Ö</label>
                                <input type="number" id="dadRestDays" placeholder="2" min="1" class="w-full p-3 rounded-xl border-slate-200 bg-white text-sm shadow-sm focus:ring-2 focus:ring-blue-500 outline-none">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ú–ê–ú–´ -->
                <div class="bg-gradient-to-br from-pink-50 to-white p-4 rounded-2xl border border-pink-100 shadow-sm">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-8 h-8 rounded-lg bg-pink-500 flex items-center justify-center text-white shadow-md shadow-pink-200">
                            <i data-lucide="briefcase" class="w-4 h-4"></i>
                        </div>
                        <h3 class="font-bold text-base text-slate-800">–ú–∞–º–∞</h3>
                    </div>
                    
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–ü–µ—Ä–≤–∞—è —Å–º–µ–Ω–∞</label>
                            <input type="date" id="momStartDate" class="w-full p-3 rounded-xl border-slate-200 bg-white text-slate-800 text-sm font-medium shadow-sm focus:ring-2 focus:ring-pink-500 focus:border-pink-500 outline-none transition-all">
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–†–∞–±–æ—á–∏—Ö</label>
                                <input type="number" id="momWorkDays" placeholder="2" min="1" class="w-full p-3 rounded-xl border-slate-200 bg-white text-sm shadow-sm focus:ring-2 focus:ring-pink-500 outline-none">
                            </div>
                            <div>
                                <label class="block text-[10px] font-bold text-slate-500 uppercase mb-1 ml-1">–í—ã—Ö–æ–¥–Ω—ã—Ö</label>
                                <input type="number" id="momRestDays" placeholder="2" min="1" class="w-full p-3 rounded-xl border-slate-200 bg-white text-sm shadow-sm focus:ring-2 focus:ring-pink-500 outline-none">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 mb-4">
                <button onclick="saveData()" class="w-full py-3.5 bg-indigo-600 text-white rounded-xl font-bold text-base shadow-xl shadow-indigo-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2">
                    <i data-lucide="save" class="w-5 h-5"></i>
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        const STORAGE_KEY = 'home_alone_app_data_v1';

        let appData = {
            dad: { start: '', work: 2, rest: 2 },
            mom: { start: '', work: 2, rest: 2 },
            lastUpdated: null
        };

        function loadData() {
            try {
                const rawData = localStorage.getItem(STORAGE_KEY);
                if (rawData) {
                    appData = JSON.parse(rawData);
                    fillFormFromData();
                } else {
                    setTimeout(() => toggleSettings(true), 800);
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞:', e);
            }
        }

        function saveData() {
            appData.dad.start = document.getElementById('dadStartDate').value;
            appData.dad.work = parseInt(document.getElementById('dadWorkDays').value) || 1;
            appData.dad.rest = parseInt(document.getElementById('dadRestDays').value) || 1;

            appData.mom.start = document.getElementById('momStartDate').value;
            appData.mom.work = parseInt(document.getElementById('momWorkDays').value) || 1;
            appData.mom.rest = parseInt(document.getElementById('momRestDays').value) || 1;
            
            appData.lastUpdated = new Date().toISOString();

            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
                toggleSettings(false);
                renderCalendar();
            } catch (e) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!');
            }
        }

        function fillFormFromData() {
            if(appData.dad.start) document.getElementById('dadStartDate').value = appData.dad.start;
            document.getElementById('dadWorkDays').value = appData.dad.work;
            document.getElementById('dadRestDays').value = appData.dad.rest;
            
            if(appData.mom.start) document.getElementById('momStartDate').value = appData.mom.start;
            document.getElementById('momWorkDays').value = appData.mom.work;
            document.getElementById('momRestDays').value = appData.mom.rest;
        }

        let currentDate = new Date();

        function isWorking(targetDate, personSettings) {
            if (!personSettings.start) return false;

            const startDate = new Date(personSettings.start);
            startDate.setHours(0, 0, 0, 0);
            
            const target = new Date(targetDate);
            target.setHours(0, 0, 0, 0);

            const diffTime = target - startDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            if (diffDays < 0) return false;

            const cycleLength = personSettings.work + personSettings.rest;
            const dayInCycle = diffDays % cycleLength;

            return dayInCycle < personSettings.work;
        }

        function renderCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthLabel = document.getElementById('currentMonthYear');
            
            grid.innerHTML = '';
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();

            const monthName = new Intl.DateTimeFormat('ru-RU', { month: 'long', year: 'numeric' }).format(currentDate);
            monthLabel.textContent = monthName;

            const firstDayOfMonth = new Date(year, month, 1);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let startDay = firstDayOfMonth.getDay(); 
            startDay = startDay === 0 ? 6 : startDay - 1; 

            const today = new Date();
            today.setHours(0,0,0,0);

            // –ü—É—Å—Ç—ã–µ —è—á–µ–π–∫–∏
            for (let i = 0; i < startDay; i++) {
                grid.appendChild(document.createElement('div'));
            }

            for (let d = 1; d <= daysInMonth; d++) {
                const dateToCheck = new Date(year, month, d);
                
                const dadWorking = isWorking(dateToCheck, appData.dad);
                const momWorking = isWorking(dateToCheck, appData.mom);
                
                let isAlone = false;
                let bgClass = 'bg-white border-slate-200 text-slate-600';
                
                if (dadWorking && momWorking) {
                    isAlone = true;
                    // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Z-index –∏ scale, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –∏ —Ä–∞–º–∫–∏
                    bgClass = 'bg-emerald-500 text-white shadow-md shadow-emerald-200 border-emerald-400 font-bold z-0';
                } else if (dadWorking) {
                    bgClass = 'bg-blue-50 text-blue-700 border-blue-100';
                } else if (momWorking) {
                    bgClass = 'bg-pink-50 text-pink-700 border-pink-100';
                }

                const isToday = dateToCheck.getTime() === today.getTime();
                // Today ring –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ
                const todayRing = isToday ? 'ring-2 ring-indigo-600 ring-offset-1 z-10' : '';

                if (isToday) {
                    const statusTextEl = document.getElementById('todayStatusText');
                    if (isAlone) statusTextEl.innerHTML = '<span class="text-emerald-600">–°–≤–æ–±–æ–¥–∞! –¢—ã –æ–¥–∏–Ω! ü•≥</span>';
                    else if (dadWorking) statusTextEl.innerText = '–ü–∞–ø–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ú–∞–º–∞ –¥–æ–º–∞';
                    else if (momWorking) statusTextEl.innerText = '–ú–∞–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ü–∞–ø–∞ –¥–æ–º–∞';
                    else statusTextEl.innerText = '–í—Å–µ –¥–æ–º–∞ üè†';
                }

                const cell = document.createElement('div');
                // –§–ò–ö–° –í–´–°–û–¢–´: h-[70px] - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è iPhone —ç–∫—Ä–∞–Ω–∞, –≤–ª–µ–∑–∞–µ—Ç 6 —Å—Ç—Ä–æ–∫
                cell.className = `h-[70px] rounded-xl border flex flex-col justify-between p-1.5 transition-all relative ${bgClass} ${todayRing}`;
                cell.style.animationDelay = `${d * 10}ms`;
                cell.classList.add('fade-in');
                
                cell.innerHTML = `
                    <div class="flex justify-between items-start">
                        <span class="text-sm font-medium leading-none">${d}</span>
                        ${isAlone ? '<i data-lucide="party-popper" class="w-3.5 h-3.5"></i>' : ''}
                    </div>
                    
                    <div class="flex gap-1 justify-end mt-1">
                       ${dadWorking && !isAlone ? '<div class="w-1.5 h-1.5 rounded-full bg-blue-500"></div>' : ''}
                       ${momWorking && !isAlone ? '<div class="w-1.5 h-1.5 rounded-full bg-pink-500"></div>' : ''}
                    </div>
                `;
                
                grid.appendChild(cell);
            }
            lucide.createIcons();
        }

        function toggleSettings(forceOpen = null) {
            const modal = document.getElementById('settingsModal');
            const panel = document.getElementById('settingsPanel');
            const isOpen = forceOpen !== null ? !forceOpen : !modal.classList.contains('hidden');

            if (isOpen) {
                panel.classList.remove('translate-y-0');
                panel.classList.add('translate-y-full');
                modal.classList.remove('opacity-100');
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            } else {
                modal.classList.remove('hidden');
                void modal.offsetWidth;
                modal.classList.remove('opacity-0');
                modal.classList.add('opacity-100');
                panel.classList.remove('translate-y-full');
                panel.classList.add('translate-y-0');
            }
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });
        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        loadData();
        renderCalendar();

    </script>
</body>
</html>
